<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="light">

<head><script src="/datamatiker-portfolio/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=datamatiker-portfolio/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Implementation &amp; Validering | 4. Semester Portfolio - Simon</title>
<meta name="keywords" content="">
<meta name="description" content="Fra arkitektur til kode: Privacy, Lambda og konceptuel validering">
<meta name="author" content="Simon">
<link rel="canonical" href="http://localhost:1313/datamatiker-portfolio/data-science/implementation/">
<link crossorigin="anonymous" href="/datamatiker-portfolio/assets/css/stylesheet.fd5566c526ae48aadabd950798a2dc3568536401560eae5caac3765a42a9e7b5.css" integrity="sha256-/VVmxSauSKravZUHmKLcNWhTZAFWDq5cqsN2WkKp57U=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/datamatiker-portfolio/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/datamatiker-portfolio/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/datamatiker-portfolio/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/datamatiker-portfolio/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/datamatiker-portfolio/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/datamatiker-portfolio/data-science/implementation/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/datamatiker-portfolio/" accesskey="h" title="4. Semester Portfolio - Simon (Alt + H)">4. Semester Portfolio - Simon</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/" title="Forside">
                    <span>Forside</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/om-projektet/" title="Om Projektet">
                    <span>Om Projektet</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/laeringsmaal/" title="Læringsmål">
                    <span>Læringsmål</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/database/" title="Database &amp; Storage">
                    <span>Database &amp; Storage</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/data-science/" title="Data Science &amp; Analytics">
                    <span>Data Science &amp; Analytics</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/vidensrejse/" title="Vidensrejse">
                    <span>Vidensrejse</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/refleksion/" title="Samlet Refleksion">
                    <span>Samlet Refleksion</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/datamatiker-portfolio/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/datamatiker-portfolio/data-science/">Data Science &amp; Analytics</a></div>
    <h1 class="post-title entry-hint-parent">
      Implementation &amp; Validering
    </h1>
    <div class="post-description">
      Fra arkitektur til kode: Privacy, Lambda og konceptuel validering
    </div>
    <div class="post-meta"><span>Simon</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#fra-arkitektur-til-kode" aria-label="Fra Arkitektur til Kode">Fra Arkitektur til Kode</a></li>
                <li>
                    <a href="#privacy-first-logging-dp2" aria-label="Privacy-First Logging (DP2)">Privacy-First Logging (DP2)</a><ul>
                        
                <li>
                    <a href="#tre-transformationer" aria-label="Tre Transformationer">Tre Transformationer</a></li>
                <li>
                    <a href="#analytics-service" aria-label="Analytics Service">Analytics Service</a></li>
                <li>
                    <a href="#gdpr-compliance-check" aria-label="GDPR Compliance Check">GDPR Compliance Check</a></li></ul>
                </li>
                <li>
                    <a href="#database--lambda-lite-architecture-dp1--dp3" aria-label="Database &amp; Lambda Lite Architecture (DP1 &#43; DP3)">Database &amp; Lambda Lite Architecture (DP1 + DP3)</a><ul>
                        
                <li>
                    <a href="#database-schema" aria-label="Database Schema">Database Schema</a></li>
                <li>
                    <a href="#lambda-lite-hot-vs-cold-path" aria-label="Lambda Lite: Hot vs Cold Path">Lambda Lite: Hot vs Cold Path</a></li>
                <li>
                    <a href="#query-eksempler" aria-label="Query Eksempler">Query Eksempler</a></li></ul>
                </li>
                <li>
                    <a href="#konceptuel-validering-dp1-dp4" aria-label="Konceptuel Validering (DP1-DP4)">Konceptuel Validering (DP1-DP4)</a><ul>
                        
                <li>
                    <a href="#validation-1-privacy-compliance-dp2" aria-label="Validation 1: Privacy Compliance (DP2)">Validation 1: Privacy Compliance (DP2)</a></li>
                <li>
                    <a href="#validation-2-smart-criteria-dp1" aria-label="Validation 2: SMART Criteria (DP1)">Validation 2: SMART Criteria (DP1)</a></li>
                <li>
                    <a href="#validation-3-lambda-performance-dp3" aria-label="Validation 3: Lambda Performance (DP3)">Validation 3: Lambda Performance (DP3)</a></li>
                <li>
                    <a href="#validation-4-goodhart-resistance-dp4" aria-label="Validation 4: Goodhart Resistance (DP4)">Validation 4: Goodhart Resistance (DP4)</a></li></ul>
                </li>
                <li>
                    <a href="#dashboard-mapping" aria-label="Dashboard Mapping">Dashboard Mapping</a></li>
                <li>
                    <a href="#implementation-summary" aria-label="Implementation Summary">Implementation Summary</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="fra-arkitektur-til-kode">Fra Arkitektur til Kode<a hidden class="anchor" aria-hidden="true" href="#fra-arkitektur-til-kode">#</a></h2>
<p>Design Patterns definerede fire normative regler for analytics-systemet. Implementation operationaliserer dem gennem konkret C#-kode, PostgreSQL-struktur og systematisk validering.</p>
<p>Denne sektion dokumenterer implementeringen af:</p>
<ol>
<li><strong>Privacy-First Logging</strong> (DP2): Hvordan raw text transformeres til anonyme kategorier</li>
<li><strong>Database Architecture</strong> (DP1+DP3): Layered schema med hot/cold separation</li>
<li><strong>Konceptuel Validation</strong> (DP1-DP4): Systematisk verifikation gennem teoretisk analyse</li>
</ol>
<p>Målet er at demonstrere at design patterns kan operationaliseres konkret – og at implementeringen kan forsvares både teknisk og juridisk. Koden er forenklet til MVP-niveau for at illustrere principper uden enterprise-kompleksitet.</p>
<hr>
<h2 id="privacy-first-logging-dp2">Privacy-First Logging (DP2)<a hidden class="anchor" aria-hidden="true" href="#privacy-first-logging-dp2">#</a></h2>
<p><strong>Pattern operationaliseret:</strong> DP2 (Privacy-First Logging)</p>
<p><strong>Designprincip:</strong> Data transformeres irreversibelt <em>før</em> database-write. Raw text når aldrig disk.</p>
<h3 id="tre-transformationer">Tre Transformationer<a hidden class="anchor" aria-hidden="true" href="#tre-transformationer">#</a></h3>
<p><strong>1. Intent Classification</strong></p>
<p>Raw text analyseres og kategoriseres in-memory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">IntentClassifier</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Note: Dette er en deterministisk, regel-baseret classifier (MVP).</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// I en produktions-kontekst ville denne logik erstattes af et kald til en NLP-model </span>
</span></span><span class="line"><span class="cl">    <span class="c1">// (f.eks. BERT), men arkitekturen og interfacet ville forblive uændret.</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">DetectIntent</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">text</span> <span class="p">=</span> <span class="n">message</span><span class="p">.</span><span class="n">ToLower</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;ondt&#34;</span><span class="p">)</span> <span class="p">||</span> <span class="n">text</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;smerter&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;health_query&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;tid&#34;</span><span class="p">)</span> <span class="p">||</span> <span class="n">text</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&#34;aftale&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;booking&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;general_info&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Hvorfor det virker:</strong> Keyword-matching er tilstrækkeligt for proof-of-concept. Raw text persisteres aldrig – kun kategorien gemmes. Beskedindholdet &ldquo;Jeg har ondt i hovedet&rdquo; bliver til kategorien &ldquo;health_query&rdquo;. Den originale sætning kasseres efter kategorisering.</p>
<p><strong>GDPR Art. 9 compliance:</strong> Sundhedsdata (special category) transformeres til generisk kategori før persistering. Ingen følsomme data når databasen.</p>
<p><strong>2. Anonymisering af User ID</strong></p>
<p>User IDs transformeres irreversibelt før persistering. Systemet bruger en deterministisk SHA-256 hash med daglig salt, så samme userID giver samme hash den pågældende dag, men ikke kan spores på tværs af dage uden salten.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">HashingService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// I produktion roteres salten via KeyVault (fx én salt per døgn)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">string</span> <span class="n">_dailySalt</span> <span class="p">=</span> <span class="s">&#34;salt-2024-11-23&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">string</span> <span class="n">HashUserId</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">using</span> <span class="nn">var</span> <span class="n">sha256</span> <span class="p">=</span> <span class="n">SHA256</span><span class="p">.</span><span class="n">Create</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">combined</span> <span class="p">=</span> <span class="n">userId</span> <span class="p">+</span> <span class="n">_dailySalt</span><span class="p">;</span> <span class="c1">// deterministisk samme dag</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">sha256</span><span class="p">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">combined</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// Returner deterministisk hash (samme input = samme output)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToBase64String</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Hvorfor det virker:</strong></p>
<ul>
<li><strong>Same day tracking:</strong> Samme user får samme hash inden for én dag. Dette tillader daglige metrics som &ldquo;Daily Active Users&rdquo; og retention calculations.</li>
<li><strong>Cross-day prevention:</strong> Samme user får forskellige hashes hver dag. User <code>123</code> bliver til hash <code>A7f2x...</code> mandag og <code>K9p1z...</code> tirsdag. Ingen long-term tracking mulig.</li>
<li><strong>Irreversibilitet:</strong> SHA-256 er en one-way function. Original user ID kan ikke genskabes fra hashen, selv med adgang til databasen.</li>
<li><strong>Privacy-by-design:</strong> Systemet kan aggregere &ldquo;hvor mange unikke users i dag?&rdquo; uden at kende identiteten.</li>
<li><strong>Analytics-støtte:</strong> Retention, DAU, cohort metrics og multi-event linking fungerer, fordi hashen er konsistent over sessions inden for samme tidsperiode.</li>
</ul>
<p><strong>Daily salt rationale:</strong> Saltet sikrer at samme user ID hasher forskelligt hver dag. Dette forhindrer cross-session tracking over tid, men tillader stadig intra-day analytics som er nødvendige for metrics som task completion rate og daily retention.</p>
<p><strong>GDPR Art. 15 compliance:</strong> User kan request egen data ved at hashe deres eget ID for den aktuelle dag og query <code>WHERE session_hash = [calculated_hash]</code>. Dog kun for current day – historical data er ikke associerbar.</p>
<p><strong>3. Temporal Aggregation</strong></p>
<p>Præcise timestamps aggregeres til hour buckets:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">TimeService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">DateTime</span> <span class="n">RoundToHour</span><span class="p">(</span><span class="n">DateTime</span> <span class="n">timestamp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="p">.</span><span class="n">Year</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="p">.</span><span class="n">Month</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="p">.</span><span class="n">Day</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="p">.</span><span class="n">Hour</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="m">0</span><span class="p">,</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Rationale:</strong> Hour-level præcision er tilstrækkeligt for analytics. Timestamp <code>&quot;14:37:42&quot;</code> bliver til <code>&quot;14:00:00&quot;</code>. Minutpræcision kasseres for at reducere granularitet og beskytte privatlivets fred.</p>
<h3 id="analytics-service">Analytics Service<a hidden class="anchor" aria-hidden="true" href="#analytics-service">#</a></h3>
<p>Hele logging-flowet kombinerer de tre transformationer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">AnalyticsService</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">IntentClassifier</span> <span class="n">_classifier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">HashingService</span> <span class="n">_hasher</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">TimeService</span> <span class="n">_timeService</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">LogEvent</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">intent</span> <span class="p">=</span> <span class="n">_classifier</span><span class="p">.</span><span class="n">DetectIntent</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">hash</span> <span class="p">=</span> <span class="n">_hasher</span><span class="p">.</span><span class="n">HashUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">hour</span> <span class="p">=</span> <span class="n">_timeService</span><span class="p">.</span><span class="n">RoundToHour</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">eventData</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AnalyticsEvent</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">SessionHash</span> <span class="p">=</span> <span class="n">hash</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">IntentCategory</span> <span class="p">=</span> <span class="n">intent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">HourBucket</span> <span class="p">=</span> <span class="n">hour</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ChatbotType</span> <span class="p">=</span> <span class="s">&#34;guest&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">SaveToDatabase</span><span class="p">(</span><span class="n">eventData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Kritisk pointe:</strong> <code>message</code> variablen går ude af scope efter <code>DetectIntent()</code>. Raw text garbage collects og når aldrig disk. Kun anonymiserede metadata persisteres.</p>
<h3 id="gdpr-compliance-check">GDPR Compliance Check<a hidden class="anchor" aria-hidden="true" href="#gdpr-compliance-check">#</a></h3>
<table>
  <thead>
      <tr>
          <th>GDPR Article</th>
          <th>Implementation</th>
          <th>Opfyldt</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Art. 5 (Minimization)</td>
          <td>Kun intent categories gemmes</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Art. 9 (Special category)</td>
          <td>&ldquo;Jeg har migræne&rdquo; → &ldquo;health_query&rdquo;</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Art. 15 (Access rights)</td>
          <td>User kan query egen SessionHash</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Art. 17 (Right to erasure)</td>
          <td><code>DELETE WHERE session_hash = X</code></td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Art. 25 (Privacy by design)</td>
          <td>Anonymization før write</td>
          <td>✅</td>
      </tr>
  </tbody>
</table>
<p><strong>Konsekvens:</strong> System er GDPR-compliant by design. Ingen post-processing eller manuel redaction nødvendig.</p>
<hr>
<h2 id="database--lambda-lite-architecture-dp1--dp3">Database &amp; Lambda Lite Architecture (DP1 + DP3)<a hidden class="anchor" aria-hidden="true" href="#database--lambda-lite-architecture-dp1--dp3">#</a></h2>
<p><strong>Patterns operationaliseret:</strong> DP1 (Layered Metrics) + DP3 (Dual-Speed Analytics)</p>
<p><strong>Designprincip:</strong> Simpel struktur med clear separation mellem operational data (hot) og analytical data (cold).</p>
<h3 id="database-schema">Database Schema<a hidden class="anchor" aria-hidden="true" href="#database-schema">#</a></h3>
<p><strong>To primære tabeller:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">analytics_events</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">session_hash</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">intent_category</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">hour_bucket</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">chatbot_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">user_metrics</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">metric_name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">metric_value</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">chatbot_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">day</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>Hvorfor denne struktur?</strong></p>
<ul>
<li><strong>analytics_events:</strong> Raw anonymized events. Intet PII, kun hashes og categories. Denne tabel vokser løbende.</li>
<li><strong>user_metrics:</strong> Pre-aggregated daily metrics. Læses af dashboards. Denne tabel indeholder færre rækker (én per metric per dag).</li>
</ul>
<p><strong>Layered Approach (DP1):</strong></p>
<ul>
<li>System metrics: Response time, errors (logges direkte til application logs, ikke analytics database)</li>
<li>User metrics: Task success, retention (gemmes i <code>user_metrics</code>)</li>
<li>Business metrics: Beregnes from <code>user_metrics</code> via simple queries</li>
</ul>
<p><strong>Rationale for separation:</strong> Engineering dashboards skal ikke se user metrics. Product dashboards skal ikke se system logs. Separation forhindrer metric pollution.</p>
<h3 id="lambda-lite-hot-vs-cold-path">Lambda Lite: Hot vs Cold Path<a hidden class="anchor" aria-hidden="true" href="#lambda-lite-hot-vs-cold-path">#</a></h3>
<p><strong>Hot Path (Real-time):</strong></p>
<p>Real-time metrics holdes in-memory:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">HotPathMonitor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">_activeSessionsCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">IncrementActiveSessions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_activeSessionsCount</span><span class="p">++;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="n">GetActiveSessions</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">_activeSessionsCount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Karakteristika:</strong></p>
<ul>
<li>Latency: &lt;1 sekund</li>
<li>Precision: Approximate (tæller resetter ved application restart)</li>
<li>Use case: &ldquo;Hvor mange aktive users lige nu?&rdquo;</li>
<li>Trade-off: Fast men ikke persistent</li>
</ul>
<p><strong>Cold Path (Batch):</strong></p>
<p>Historiske metrics aggregeres dagligt via SQL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">user_metrics</span><span class="w"> </span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span><span class="w"> </span><span class="n">metric_value</span><span class="p">,</span><span class="w"> </span><span class="n">chatbot_type</span><span class="p">,</span><span class="w"> </span><span class="k">day</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;daily_active_users&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">session_hash</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">chatbot_type</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">DATE</span><span class="p">(</span><span class="n">hour_bucket</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">analytics_events</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="nb">DATE</span><span class="p">(</span><span class="n">hour_bucket</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">chatbot_type</span><span class="p">,</span><span class="w"> </span><span class="nb">DATE</span><span class="p">(</span><span class="n">hour_bucket</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><strong>Karakteristika:</strong></p>
<ul>
<li>Latency: Daglig (køres kl. 02:00 via cron job)</li>
<li>Precision: Exact (baseret på alle events fra foregående dag)</li>
<li>Use case: &ldquo;Hvor mange aktive users havde vi i går?&rdquo;</li>
<li>Trade-off: Langsom men præcis og persistent</li>
</ul>
<p><strong>Hvorfor Lambda Lite?</strong></p>
<ul>
<li><strong>Hot Path:</strong> Owner skal se error spikes indenfor sekunder for at reagere operationelt</li>
<li><strong>Cold Path:</strong> Product Owner vil se retention trends over uger for strategiske beslutninger</li>
<li><strong>Acceptable lag:</strong> Cold Path lags 1 dag, men det er acceptabelt for strategic planning</li>
</ul>
<h3 id="query-eksempler">Query Eksempler<a hidden class="anchor" aria-hidden="true" href="#query-eksempler">#</a></h3>
<p><strong>Hot Path - Real-time Counter:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">activeNow</span> <span class="p">=</span> <span class="n">_monitor</span><span class="p">.</span><span class="n">GetActiveSessions</span><span class="p">();</span> <span class="c1">// In-memory read</span>
</span></span></code></pre></div><p><strong>Cold Path - Weekly Average:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">last7days</span> <span class="p">=</span> <span class="n">metrics</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Day</span> <span class="p">&gt;=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(-</span><span class="m">7</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="kt">var</span> <span class="n">average</span> <span class="p">=</span> <span class="n">last7days</span><span class="p">.</span><span class="n">Average</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">MetricValue</span><span class="p">);</span>
</span></span></code></pre></div><p><strong>Forskellen:</strong> Hot Path bruges til operational alerts (&ldquo;System har 50% error rate lige nu!&rdquo;). Cold Path bruges til trend analysis (&ldquo;Retention er faldet 10% over sidste måned&rdquo;).</p>
<hr>
<h2 id="konceptuel-validering-dp1-dp4">Konceptuel Validering (DP1-DP4)<a hidden class="anchor" aria-hidden="true" href="#konceptuel-validering-dp1-dp4">#</a></h2>
<p><strong>Metodisk note:</strong> Da systemet ikke har live-trafik, er valideringen her konceptuel. Resultaterne er baseret på arkitektur-audits og simulerede data-flow (Mock Data), som indikerer systemets forventede adfærd i produktion.</p>
<p>Uden live traffic anvendes systematisk konceptuel validering gennem fire metoder:</p>
<ol>
<li><strong>Privacy Audit:</strong> Verificer ingen PII kan persisteres</li>
<li><strong>SMART Criteria:</strong> Verificer KPIs opfylder målbarhedskrav</li>
<li><strong>Architecture Review:</strong> Verificer hot/cold separation er korrekt implementeret</li>
<li><strong>Goodhart Audit:</strong> Verificer metrics ikke kan gamificeres</li>
</ol>
<h3 id="validation-1-privacy-compliance-dp2">Validation 1: Privacy Compliance (DP2)<a hidden class="anchor" aria-hidden="true" href="#validation-1-privacy-compliance-dp2">#</a></h3>
<p><strong>Metode:</strong> Teoretisk gennemgang af dataflow.</p>
<p><strong>Analyseret scenario:</strong></p>
<ul>
<li>Input: User sender &ldquo;Jeg har migræne og kvalme&rdquo;</li>
<li>Processing: Intent classification → &ldquo;health_query&rdquo;</li>
<li>Output: Database indeholder kun &ldquo;health_query&rdquo;, ikke raw text</li>
</ul>
<p><strong>Privacy checklist:</strong></p>
<table>
  <thead>
      <tr>
          <th>Check</th>
          <th>Forventet resultat</th>
          <th>Begrundelse</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Raw text i database?</td>
          <td>❌ Nej</td>
          <td>DetectIntent() kasserer input efter kategorisering</td>
      </tr>
      <tr>
          <td>Original user ID i database?</td>
          <td>❌ Nej</td>
          <td>HashUserId() genererer irreversibel hash</td>
      </tr>
      <tr>
          <td>Præcise timestamps?</td>
          <td>❌ Nej</td>
          <td>RoundToHour() fjerner minut/sekund præcision</td>
      </tr>
      <tr>
          <td>Special category data?</td>
          <td>❌ Nej</td>
          <td>Sundhedsdata transformeret til generisk kategori</td>
      </tr>
  </tbody>
</table>
<p><strong>Forventet resultat:</strong> Ingen events bør indeholde PII, fordi anonymisering sker før database-write. GDPR Art. 5, 9, og 25 overholdes by design.</p>
<h3 id="validation-2-smart-criteria-dp1">Validation 2: SMART Criteria (DP1)<a hidden class="anchor" aria-hidden="true" href="#validation-2-smart-criteria-dp1">#</a></h3>
<p><strong>Metode:</strong> Verificer hvert KPI opfylder Specific, Measurable, Actionable, Relevant, Time-bound.</p>
<table>
  <thead>
      <tr>
          <th>KPI</th>
          <th>Specific?</th>
          <th>Measurable?</th>
          <th>Actionable?</th>
          <th>Relevant?</th>
          <th>Valid?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Task Success Rate</td>
          <td>✅ Clear definition</td>
          <td>✅ Intent completion</td>
          <td>✅ Improve UX</td>
          <td>✅ User value</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>7-day Retention</td>
          <td>✅ Clear timeframe</td>
          <td>✅ Returning users</td>
          <td>✅ Product changes</td>
          <td>✅ Growth</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Avg Time-to-Answer</td>
          <td>✅ Clear metric</td>
          <td>✅ Timestamp diff</td>
          <td>✅ Bot tuning</td>
          <td>✅ Efficiency</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Total Messages</td>
          <td>❌ Unclear goal</td>
          <td>✅ Countable</td>
          <td>❌ Reward confusion</td>
          <td>❌ Vanity</td>
          <td>❌</td>
      </tr>
      <tr>
          <td>Session Duration</td>
          <td>❌ Ambiguous</td>
          <td>✅ Timestamp diff</td>
          <td>❌ Confusion vs engagement</td>
          <td>❌ Misleading</td>
          <td>❌</td>
      </tr>
  </tbody>
</table>
<p><strong>Forventet resultat:</strong> 6/8 KPIs valideres. &ldquo;Total Messages&rdquo; og &ldquo;Session Duration&rdquo; elimineres som vanity metrics per Goodhart&rsquo;s Law.</p>
<h3 id="validation-3-lambda-performance-dp3">Validation 3: Lambda Performance (DP3)<a hidden class="anchor" aria-hidden="true" href="#validation-3-lambda-performance-dp3">#</a></h3>
<p><strong>Metode:</strong> Arkitektur review af hot/cold separation.</p>
<p><strong>Hot Path Analysis:</strong></p>
<ul>
<li><strong>Data structure:</strong> In-memory integer counter</li>
<li><strong>Update mechanism:</strong> Simple increment operation</li>
<li><strong>Read latency:</strong> O(1) constant time</li>
<li><strong>Forventet performance:</strong> &lt;100ms response time</li>
</ul>
<p><strong>Cold Path Analysis:</strong></p>
<ul>
<li><strong>Data structure:</strong> PostgreSQL aggregation table</li>
<li><strong>Update mechanism:</strong> Daily batch query med GROUP BY</li>
<li><strong>Read latency:</strong> Simple SELECT på indexed table</li>
<li><strong>Forventet performance:</strong> &lt;5 sekunder for 30-day query</li>
</ul>
<p><strong>Separation verification:</strong></p>
<table>
  <thead>
      <tr>
          <th>Requirement</th>
          <th>Hot Path</th>
          <th>Cold Path</th>
          <th>Valid?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Real-time capability</td>
          <td>✅ &lt;1 sec</td>
          <td>❌ Daily lag</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Historical accuracy</td>
          <td>❌ Resets</td>
          <td>✅ Persistent</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Operational alerts</td>
          <td>✅ Immediate</td>
          <td>❌ Too slow</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Trend analysis</td>
          <td>❌ No history</td>
          <td>✅ Full data</td>
          <td>✅</td>
      </tr>
  </tbody>
</table>
<p><strong>Forventet resultat:</strong> Hot/cold separation er arkitektonisk korrekt. Hvert path løser sin use case uden at blande concerns.</p>
<h3 id="validation-4-goodhart-resistance-dp4">Validation 4: Goodhart Resistance (DP4)<a hidden class="anchor" aria-hidden="true" href="#validation-4-goodhart-resistance-dp4">#</a></h3>
<p><strong>Metode:</strong> Systematisk audit per KPI gennem tre tests.</p>
<p><strong>Test framework:</strong></p>
<ol>
<li><strong>Gaming test:</strong> Hvis systemet optimerer mod denne metric, skader det brugeren?</li>
<li><strong>Manipulation test:</strong> Kan metric&rsquo;en manipuleres uden reel værdi?</li>
<li><strong>Pairing test:</strong> Bør den parres med kvalitativ kontrolmåling?</li>
</ol>
<p><strong>Audit resultater:</strong></p>
<table>
  <thead>
      <tr>
          <th>KPI</th>
          <th>Gaming Risk?</th>
          <th>Manipulation?</th>
          <th>Pairing Needed?</th>
          <th>Valid?</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Task Success Rate</td>
          <td>⚠️ False positives</td>
          <td>⚠️ Trigger-happy bot</td>
          <td>✅ Pair med satisfaction</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>7-day Retention</td>
          <td>✅ Low risk</td>
          <td>✅ Hard to fake</td>
          <td>❌ Standalone OK</td>
          <td>✅</td>
      </tr>
      <tr>
          <td>Total Messages</td>
          <td>❌ Rewards loops</td>
          <td>❌ Bot kan spam</td>
          <td>❌ Fundamentalt flawed</td>
          <td>❌</td>
      </tr>
  </tbody>
</table>
<p><strong>Forventet resultat:</strong> Context-aware KPIs modstår Goodhart gaming når de parres korrekt. &ldquo;Total Messages&rdquo; elimineres da den inherent belønner confusion.</p>
<p><strong>Kritisk indsigt:</strong> Guest chatbot måles på efficiency (time-to-answer). Authenticated chatbot måles på engagement (7-day retention). Owner chatbot måles på reliability (error rate). Samme metric på tværs af contexts ville skabe Goodhart-problemer.</p>
<hr>
<h2 id="dashboard-mapping">Dashboard Mapping<a hidden class="anchor" aria-hidden="true" href="#dashboard-mapping">#</a></h2>
<p><strong>Designprincip:</strong> Hvert dashboard læser kun relevant data. Ingen cross-contamination mellem stakeholder views.</p>
<table>
  <thead>
      <tr>
          <th>Dashboard</th>
          <th>Audience</th>
          <th>Data Source</th>
          <th>Primary KPI</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Engineering</td>
          <td>DevOps</td>
          <td>Application logs (ikke analytics DB)</td>
          <td>Error rate trends</td>
      </tr>
      <tr>
          <td>Product</td>
          <td>Product Owner</td>
          <td><code>user_metrics</code> table</td>
          <td>7-day Retention</td>
      </tr>
      <tr>
          <td>Executive</td>
          <td>Owner</td>
          <td><code>user_metrics</code> aggregated</td>
          <td>Daily Active Users</td>
      </tr>
  </tbody>
</table>
<p><strong>Implementation eksempel:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">ProductDashboard</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">double</span> <span class="n">GetRetentionRate</span><span class="p">(</span><span class="kt">string</span> <span class="n">chatbotType</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">last7days</span> <span class="p">=</span> <span class="n">_db</span><span class="p">.</span><span class="n">UserMetrics</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">ChatbotType</span> <span class="p">==</span> <span class="n">chatbotType</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">MetricName</span> <span class="p">==</span> <span class="s">&#34;daily_active_users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">m</span> <span class="p">=&gt;</span> <span class="n">m</span><span class="p">.</span><span class="n">Day</span> <span class="p">&gt;=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(-</span><span class="m">7</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">last7days</span><span class="p">.</span><span class="n">Average</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">MetricValue</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Context-Aware Success (DP4 applied):</strong></p>
<ul>
<li>Guest Dashboard: Shows &ldquo;Avg Time-to-Answer&rdquo; (efficiency metric)</li>
<li>Authenticated Dashboard: Shows &ldquo;7-day Retention&rdquo; (engagement metric)</li>
<li>Owner Dashboard: Shows &ldquo;Error Rate&rdquo; (reliability metric)</li>
</ul>
<p><strong>Rationale:</strong> Product Owner behøver ikke system metrics. DevOps behøver ikke user engagement metrics. Separation forhindrer information overload og metric misinterpretation.</p>
<hr>
<h2 id="implementation-summary">Implementation Summary<a hidden class="anchor" aria-hidden="true" href="#implementation-summary">#</a></h2>
<p>De fire design patterns er konkret implementeret og konceptuelt valideret:</p>
<table>
  <thead>
      <tr>
          <th>Pattern</th>
          <th>Implementation</th>
          <th>Validation Method</th>
          <th>Status</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>DP1: Layered Metrics</strong></td>
          <td>2-table PostgreSQL schema</td>
          <td>SMART audit: 6/8 valid</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><strong>DP2: Privacy-First</strong></td>
          <td>Intent + Hashing + Hour bucketing</td>
          <td>GDPR checklist: 5/5 compliant</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><strong>DP3: Lambda Lite</strong></td>
          <td>Hot (in-memory) + Cold (batch SQL)</td>
          <td>Architecture review verified</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><strong>DP4: Context-Aware</strong></td>
          <td>Chatbot-specific KPI selection</td>
          <td>Goodhart audit: resistant</td>
          <td>✅</td>
      </tr>
  </tbody>
</table>
<p><strong>Kerneprincipper operationaliseret:</strong></p>
<ol>
<li><strong>Raw text kasseres:</strong> Intent detection in-memory → kun category persisteres</li>
<li><strong>Irreversibel anonymisering:</strong> User IDs transformeret til unikke hashes før write</li>
<li><strong>Hot/cold separation:</strong> Real-time counters til operational alerts, batch aggregation til strategic trends</li>
<li><strong>Context-aware success:</strong> Guest ≠ Authenticated ≠ Owner metrics</li>
</ol>
<p><strong>Konceptuel validation bekræfter:</strong></p>
<ul>
<li>Ingen PII kan persisteres per design</li>
<li>GDPR Art. 5, 9, 15, 17, 25 compliant</li>
<li>Hot path muliggør &lt;1 sec operational alerts</li>
<li>Cold path muliggør accurate historical analysis</li>
<li>6/8 KPIs SMART validated (2 vanity metrics elimineret)</li>
</ul>
<p><strong>Begrænsninger og Fremtidigt Arbejde</strong> Koden er forenklet til at demonstrere principper uden enterprise-kompleksitet. Production-system ville kræve:</p>
<ul>
<li>Persistent hashing (ikke Guid-regeneration)</li>
<li>Transaction logging</li>
<li>Monitoring og alerting</li>
<li>Load balancing</li>
<li>Backup og disaster recovery</li>
</ul>
<p>Men MVP-implementeringen demonstrerer at design patterns er operationaliserbare og GDPR-compliant by design.</p>
<p><strong>Kritisk erkendelse:</strong> Privacy-first kræver disciplin. Det er ikke nok at &ldquo;slette data senere&rdquo; – anonymization skal ske før første database-write. Raw text må aldrig ramme disk. Dette princip er arkitektonisk håndhævet gennem AnalyticsService designet.</p>
<hr>
<p><strong>Næste:</strong> Implementation er konceptuelt verificeret. Konklusion reflekterer over læringsprocessen, samfundsmæssige perspektiver og opfyldelse af læringsmål 6-10.</p>
<p><strong>Næste:</strong> <a href="/datamatiker-portfolio/data-science/konklusion/">Konklusion →</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/datamatiker-portfolio/">4. Semester Portfolio - Simon</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
