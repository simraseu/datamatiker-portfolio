<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="light">

<head><script src="/datamatiker-portfolio/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=datamatiker-portfolio/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Problemstilling | 4. Semester Portfolio - Simon</title>
<meta name="keywords" content="">
<meta name="description" content="Specialiserings-f√¶lden og de tre arkitektoniske dilemmaer">
<meta name="author" content="Simon">
<link rel="canonical" href="http://localhost:1313/datamatiker-portfolio/database/problemstilling/">
<link crossorigin="anonymous" href="/datamatiker-portfolio/assets/css/stylesheet.fd5566c526ae48aadabd950798a2dc3568536401560eae5caac3765a42a9e7b5.css" integrity="sha256-/VVmxSauSKravZUHmKLcNWhTZAFWDq5cqsN2WkKp57U=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/datamatiker-portfolio/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/datamatiker-portfolio/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/datamatiker-portfolio/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/datamatiker-portfolio/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/datamatiker-portfolio/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/datamatiker-portfolio/database/problemstilling/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/datamatiker-portfolio/" accesskey="h" title="4. Semester Portfolio - Simon (Alt + H)">4. Semester Portfolio - Simon</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/" title="Forside">
                    <span>Forside</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/om-projektet/" title="Om Projektet">
                    <span>Om Projektet</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/laeringsmaal/" title="L√¶ringsm√•l">
                    <span>L√¶ringsm√•l</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/database/" title="Database &amp; Storage">
                    <span>Database &amp; Storage</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/data-science/" title="Data Science &amp; Analytics">
                    <span>Data Science &amp; Analytics</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/vidensrejse/" title="Vidensrejse">
                    <span>Vidensrejse</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/datamatiker-portfolio/refleksion/" title="Samlet Refleksion">
                    <span>Samlet Refleksion</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/datamatiker-portfolio/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/datamatiker-portfolio/database/">Database &amp; Storage</a></div>
    <h1 class="post-title entry-hint-parent">
      Problemstilling
    </h1>
    <div class="post-description">
      Specialiserings-f√¶lden og de tre arkitektoniske dilemmaer
    </div>
    <div class="post-meta"><span>Simon</span>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#databasernes-best-tool-paradoks" aria-label="Databasernes &ldquo;Best Tool&rdquo; Paradoks">Databasernes &ldquo;Best Tool&rdquo; Paradoks</a></li>
                <li>
                    <a href="#de-tre-arkitektoniske-dilemmaer" aria-label="De Tre Arkitektoniske Dilemmaer">De Tre Arkitektoniske Dilemmaer</a><ul>
                        
                <li>
                    <a href="#dilemma-1-the-integration-tax" aria-label="Dilemma 1: The Integration Tax 1">Dilemma 1: The Integration Tax 1</a></li>
                <li>
                    <a href="#dilemma-2-the-synchronization-nightmare" aria-label="Dilemma 2: The Synchronization Nightmare">Dilemma 2: The Synchronization Nightmare</a></li>
                <li>
                    <a href="#dilemma-3-the-consistency-myth" aria-label="Dilemma 3: The Consistency Myth">Dilemma 3: The Consistency Myth</a></li></ul>
                </li>
                <li>
                    <a href="#strategi-fra-holdning-til-evidens" aria-label="Strategi: Fra Holdning til Evidens">Strategi: Fra Holdning til Evidens</a></li>
                <li>
                    <a href="#referencer" aria-label="Referencer">Referencer</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="databasernes-best-tool-paradoks">Databasernes &ldquo;Best Tool&rdquo; Paradoks<a hidden class="anchor" aria-hidden="true" href="#databasernes-best-tool-paradoks">#</a></h2>
<p>Systemets oprindelige arkitektur lagde op til en klassisk <strong>&ldquo;Polyglot Persistence&rdquo;</strong> tilgang. For at underst√∏tte de ambiti√∏se krav til AI og chat, var antagelsen i teamet, at vi skulle bruge specialiserede v√¶rkt√∏jer til hver opgave:</p>
<ul>
<li><strong>MongoDB:</strong> Til JSON-dokumenter (Chat history)</li>
<li><strong>Pinecone:</strong> Til Vector Embeddings (Semantisk s√∏gning)</li>
<li><strong>PostgreSQL:</strong> Til brugerdata (Relationelt)</li>
</ul>
<p>Tre problemer. Tre specialiserede databaser. P√• papiret lignede det industristandarden.</p>
<p><strong>Min rolle som specialist:</strong>
Som ansvarlig for data-infrastrukturen var min opgave ikke blot at implementere denne plan, men at <strong>validere</strong> den. Jeg st√∏dte hurtigt p√• det, jeg kalder <strong>Specialiserings-f√¶lden</strong>: <em>Hvorn√•r bliver omkostningen ved at integrere specialiserede v√¶rkt√∏jer h√∏jere end gevinsten ved deres specialisering?</em></p>
<p>Jeg valgte derfor at udfordre teamets oprindelige antagelse. Dette projekt handler ikke om at v√¶lge &ldquo;den bedste database&rdquo; i et vakuum, men om at navigere i tre fundamentale dilemmaer, der opst√•r, n√•r vi fors√∏ger at splitte data op i tre systemer.</p>
<hr>
<h2 id="de-tre-arkitektoniske-dilemmaer">De Tre Arkitektoniske Dilemmaer<a hidden class="anchor" aria-hidden="true" href="#de-tre-arkitektoniske-dilemmaer">#</a></h2>
<h3 id="dilemma-1-the-integration-tax">Dilemma 1: The Integration Tax <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup><a hidden class="anchor" aria-hidden="true" href="#dilemma-1-the-integration-tax">#</a></h3>
<p><strong>Dokument-fleksibilitet vs. System-kompleksitet</strong></p>
<p><strong>Antagelsen:</strong> &ldquo;MongoDB er bedst til dokumenter, s√• vi skal bruge MongoDB til chat-logs.&rdquo;</p>
<p><strong>Konflikten:</strong> Chatbots kr√¶ver, at vi linker brugerprofiler (SQL) med samtaler (NoSQL). Dette polyglot persistence-valg introducerer integration overhead: Vi mister simple JOINs og m√• h√•ndtere omkostninger ved data marshalling og application-level sammenl√¶gning - emner, jeg allerede har stiftet bekendtskab med, under kommunikation og arkitektur i distribuerede systemer.<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p><strong>Konkret scenarie:</strong></p>
<p><strong>Scenarie A ‚Äî MongoDB (Specialized Document DB):</strong></p>
<ul>
<li>User √•bner chathistorik med 50 samtaler</li>
<li>MongoDB loader JSON-dokumenter</li>
<li>Query tid: ~2.3 sekunder (empiriske vendor benchmarks)</li>
<li>User oplever: Frustrerende loading spinner</li>
</ul>
<p><strong>Scenarie B ‚Äî PostgreSQL (General-Purpose med JSONB):</strong></p>
<ul>
<li>User √•bner samme chathistorik</li>
<li>PostgreSQL loader JSONB med GIN index</li>
<li>Query tid: ~89ms (samme benchmarks)</li>
<li>User oplever: Instant loading</li>
</ul>
<p>To databaser. Identisk funktionalitet. <strong>Estimeret 26x performance forskel jf. benchmarks (se Research).</strong></p>
<p><strong>Sp√∏rgsm√•let:</strong> Kan en moderne relationel database h√•ndtere JSON effektivt nok til at overfl√∏digg√∏re en dedikeret dokument-database?</p>
<details>
<summary><strong>üîç Hvorfor performance paradoxet opst√•r</strong></summary>
<p><strong>MongoDB&rsquo;s BSON vs PostgreSQL&rsquo;s JSONB:</strong></p>
<p>MongoDB gemmer JSON som text-based BSON (Binary JSON). &ldquo;Binary&rdquo; betyder ikke compressed ‚Äî det betyder network-efficient.</p>
<p>PostgreSQL gemmer JSON som parsed binary structure med:</p>
<ul>
<li>Native indexing (GIN/GiST indexes)</li>
<li>Query optimizer integration</li>
<li>Zero parsing overhead</li>
</ul>
<p><strong>Resultat:</strong> Implementation quality &gt; database category.</p>
</details>
<hr>
<h3 id="dilemma-2-the-synchronization-nightmare">Dilemma 2: The Synchronization Nightmare<a hidden class="anchor" aria-hidden="true" href="#dilemma-2-the-synchronization-nightmare">#</a></h3>
<p><strong>Vector Performance vs. Data Freshness</strong></p>
<p><strong>Antagelsen:</strong> &ldquo;Vektor-s√∏gning kr√¶ver en specialiseret Vector Database som Pinecone.&rdquo;</p>
<p><strong>Konflikten:</strong> Moderne chatbots bruger &ldquo;Retrieval Augmented Generation&rdquo; (RAG), hvor vi skal finde samtaler baseret p√• <em>b√•de</em> mening (Vector) og metadata (User ID, Dato). Hvis vektorer bor i Pinecone og metadata i SQL, skal applikationen manuelt synkronisere og flette data fra to kilder.</p>
<p><strong>Konkret scenarie:</strong></p>
<p><strong>Query: &ldquo;Find semantisk lignende samtaler fra sidste m√•ned for bruger X&rdquo;</strong></p>
<p><strong>Arkitektur A ‚Äî Polyglot Persistence:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1. App ‚Üí Pinecone: &#34;Find similar vectors&#34; (200ms)
</span></span><span class="line"><span class="cl">   Response: [conv_id_1, conv_id_2, conv_id_3]
</span></span><span class="line"><span class="cl">2. App ‚Üí MongoDB: &#34;Get conversations by IDs&#34; (150ms)
</span></span><span class="line"><span class="cl">   Response: [conversation objects]
</span></span><span class="line"><span class="cl">3. App: Client-side filtering p√• metadata (user_id, timestamp) (50ms)
</span></span></code></pre></div><p><strong>Total latency: 400ms + 3 failure points</strong></p>
<p><strong>Arkitektur B ‚Äî Unified Monolith:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1. App ‚Üí PostgreSQL: Combined query (89ms)
</span></span><span class="line"><span class="cl">   SELECT * FROM conversations 
</span></span><span class="line"><span class="cl">   WHERE user_id = $1 AND timestamp &gt; $2
</span></span><span class="line"><span class="cl">   ORDER BY embedding &lt;-&gt; $3
</span></span></code></pre></div><p><strong>Total latency: 89ms + 1 failure point</strong></p>
<p><strong>Sp√∏rgsm√•let:</strong> Er det v√¶rd at ofre netv√¶rks-latency og synkroniserings-kompleksitet for at f√• de marginalt bedre s√∏ge-algoritmer, en dedikeret vector-database tilbyder?</p>
<details>
<summary><strong>üí∞ Integration Tax: Hidden Costs</strong></summary>
<p><strong>Operational costs ved Polyglot Persistence:</strong></p>
<table>
  <thead>
      <tr>
          <th>Cost Category</th>
          <th>Single DB</th>
          <th>Three DBs</th>
          <th>Delta</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Hosting</strong></td>
          <td>$50/month</td>
          <td>$150/month</td>
          <td>+$100/month</td>
      </tr>
      <tr>
          <td><strong>Monitoring</strong></td>
          <td>1 system</td>
          <td>3 systems</td>
          <td>3√ó complexity</td>
      </tr>
      <tr>
          <td><strong>GDPR deletion</strong></td>
          <td>CASCADE DELETE</td>
          <td>Manual sync across 3 DBs</td>
          <td>Compliance risk</td>
      </tr>
  </tbody>
</table>
<p><strong>√Örlig TCO ved 10k users:</strong> $4,400 ekstra for polyglot setup.</p>
</details>
<hr>
<h3 id="dilemma-3-the-consistency-myth">Dilemma 3: The Consistency Myth<a hidden class="anchor" aria-hidden="true" href="#dilemma-3-the-consistency-myth">#</a></h3>
<p><strong>Hastighed vs. P√•lidelighed (BASE vs. ACID)</strong></p>
<p><strong>Antagelsen:</strong> &ldquo;Til chat-systemer er &lsquo;Eventual Consistency&rsquo; (BASE) fint, fordi det er hurtigere end transaktioner (ACID).&rdquo;</p>
<p><strong>Konflikten:</strong> Hvis systemet crasher, lige efter brugeren har sendt en besked, men f√∏r botten svarer, efterlades brugeren i en &ldquo;broken state&rdquo;. GDPR &ldquo;Right to Erasure&rdquo; kr√¶ver desuden, at vi kan slette alt data atomisk.</p>
<p><strong>Konkret scenarie:</strong></p>
<p><strong>Failure case: System crasher mellem user message og bot response</strong></p>
<p><strong>Database A ‚Äî MongoDB (BASE / Eventual Consistency):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="mf">1.</span> <span class="n">User</span> <span class="n">message</span> <span class="n">saves</span> <span class="err">‚Üí</span> <span class="n">SUCCESS</span>
</span></span><span class="line"><span class="cl"><span class="mf">2.</span> <span class="p">[</span><span class="n">CRASH</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.</span> <span class="n">Bot</span> <span class="n">response</span> <span class="n">never</span> <span class="n">saved</span>
</span></span><span class="line"><span class="cl"><span class="mf">4.</span> <span class="n">User</span> <span class="n">ser</span><span class="p">:</span> <span class="s2">&#34;Hvorfor f√•r jeg ikke svar?&#34;</span> <span class="p">(</span><span class="n">Broken</span> <span class="n">UX</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">5.</span> <span class="n">Database</span> <span class="n">state</span><span class="p">:</span> <span class="n">Partial</span> <span class="n">save</span> <span class="p">(</span><span class="mi">70</span><span class="o">%</span> <span class="n">failure</span> <span class="n">rate</span> <span class="n">i</span> <span class="n">tests</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Database B ‚Äî PostgreSQL (ACID / Strong Consistency):</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1. Transaction START
</span></span><span class="line"><span class="cl">2. User message saves ‚Üí SUCCESS
</span></span><span class="line"><span class="cl">3. [CRASH]
</span></span><span class="line"><span class="cl">4. Transaction ROLLBACK automatically
</span></span><span class="line"><span class="cl">5. User ser: Ingen samtale (forventet opf√∏rsel)
</span></span><span class="line"><span class="cl">6. Database state: Clean, 0% corruption
</span></span></code></pre></div><p><strong>Sp√∏rgsm√•let:</strong> Er &ldquo;NoSQL hastighed&rdquo; en myte i moderne systemer, og er prisen for datatab for h√∏j?</p>
<details>
<summary><strong>‚ö†Ô∏è GDPR Implications</strong></summary>
<p><strong>Article 17: Right to Erasure</strong></p>
<p>Ved user deletion request skal <strong>all</strong> data fjernes.</p>
<p><strong>MongoDB eventual consistency risiko:</strong></p>
<ul>
<li>User data slettes i primary</li>
<li>Replication lag betyder data eksisterer i 2-3 replicas i 100-500ms</li>
<li>Crash under replication ‚Üí orphaned data (GDPR violation)</li>
</ul>
<p><strong>PostgreSQL ACID garanti:</strong></p>
<ul>
<li>CASCADE DELETE ensures atomic removal</li>
<li>Transaction commits kun n√•r all replicas confirmed</li>
<li>Zero orphaned data</li>
</ul>
</details>
<hr>
<h2 id="strategi-fra-holdning-til-evidens">Strategi: Fra Holdning til Evidens<a hidden class="anchor" aria-hidden="true" href="#strategi-fra-holdning-til-evidens">#</a></h2>
<p>I stedet for at v√¶lge teknologi baseret p√• hype (&ldquo;Vi skal bruge en Vector DB!&rdquo;), besluttede jeg at udfordre &ldquo;Best Tool&rdquo; dogmet gennem <strong>systematisk triangulering</strong>.</p>
<p>M√•let var ikke at finde &ldquo;den bedste database&rdquo;, men at forst√• <strong>trade-offs</strong> og kunne forsvare valget med evidens.</p>
<p>Jeg beh√∏vede ikke live-brugere for at besvare dette. Jeg havde brug for arkitektonisk sikkerhed.</p>
<p><strong>N√¶ste:</strong> <a href="/datamatiker-portfolio/database/research/">Research &amp; Evidens ‚Üí</a></p>
<hr>
<h2 id="referencer">Referencer<a hidden class="anchor" aria-hidden="true" href="#referencer">#</a></h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Introduktion til Distributed Systems - Hvad er et Distributed System? (Teknologi)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Distributed_Systems_4 (DS 4.03) - Chapter: Communication (Teknologi)&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/datamatiker-portfolio/">4. Semester Portfolio - Simon</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
